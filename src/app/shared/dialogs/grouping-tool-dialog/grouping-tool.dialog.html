<div class="content-header" fxLayout="row" fxLayoutAlign="space-between center">
  <div fxLayout="row">
    <input
      style="width: 100%;"
      class="title" 
      type="text"
      (keyup)="typingStoped($event)"
      (keydown)="typingStarted()"
      [(ngModel)]="groupingTitle"
      placeholder="Untitled Grouping"
      [disabled]='!editingTitle'>
    <img class="edit" src="/assets/img/grouping/edit-pen.svg" (click)="editTitle()">
  </div>
  <img fxLayout="column" class="close" (click)="closeDialog()" src="/assets/img/idea-creation/close_bigrey.svg">
</div>

<div fxLayout="row" fxLayoutAlign="space-between center" class="settings">
  <div fxLayout="row" fxLayoutGap="16px">
    <div fxLayout="column">
      <div class="header">Grouping Style</div>
      <div class="subheader">Assign workspaces</div> 
    </div>
    <div class="dropdown-controls-container" *ngIf="groupingStyles">
      <ng-select
        class="groups-controls "
        [items]="groupingStyles"
        bindLabel="title"
        placeholder="Custom"
        (change)="groupingStyleChanged($event)"
        [(ngModel)]="selectedCategory"
        appendTo="body"
        [searchable]="false"
        [clearable]="false">
        <ng-template ng-option-tmp let-item="item" let-index="index">
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
            <div fxLayout="column">
              <div class="title">{{ item.title }}</div>
              <div class="description">{{ item.description }}</div>
            </div>
          </div>
        </ng-template>
      </ng-select>
    </div>
  </div>
  <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="16px">
    <div class="header">Set # of groups</div>
    <input 
      class="groups-count" 
      type="number" 
      value="0" 
      min="0" 
      max="99"
      #noOfGroups
      (keyup)="typingStopedGroups(noOfGroups.value)"
      (keydown)="typingStartedGroups()">
  </div>
  <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="16px"
    benji-click-stop-propagation>
    <div class="header">Learners can switch groups</div>
      <label class="switch">
        <input type="checkbox" 
          [(ngModel)]="allowParticipantsJoining"
          [ngModelOptions]="{standalone: true}"
          (change)="toggleChooseGroup($event)">
        <span class="slider round"></span>
      </label>
  </div>
</div>

<div cdkDropListGroup>
  <!-- unassigned users -->
  <div>
    <div class="sub-title"> Unassigned </div>
    <div class="free-users" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px"
      cdkDropList
      [cdkDropListData]="unassignedUsers"
      (cdkDropListDropped)="drop($event)">
      <div class="user"
        cdkDrag
        *ngFor="let participant of unassignedUsers">
        <span>
          {{ participant.display_name }}
        </span>
      </div>
    </div>
  </div>

  <!-- Groups -->
  <div>
    <div class="sub-title"> Groups </div>
    <div class="groups" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
      <div *ngFor="let group of breakoutRooms">
        <div class="group" [ngClass]="{'occupied': 'group.participants'}" fxLayout="column">
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <div fxLayout="column" class="group-title">
              <div 
                *ngIf="!editingName[group.id]"
                (click)="editGroupName(group)">
                {{ group.name }}
              </div>
              <div *ngIf="editingName[group.id]" >
                <input 
                  type="text" 
                  style="width: 125px;" 
                  [(ngModel)]="groupName" 
                  (blur)="saveEditedGroupName(group)"
                  (keyup.enter)="saveEditedGroupName(group)">
              </div>
            </div>
            <div fxLayout="row" fxLayoutGap="8px">
              <span class="count">{{ group.participants.length }}</span>
              <img class="close" 
                (click)="deleteGroup(group)" 
                src="/assets/img/idea-creation/close_big.svg">
            </div>
          </div>
          <!-- <div class="bg-area" *ngIf="!group.participants">
            Drag-n-drop participants to assign them to the group
          </div> -->
          <div class="bg-area" *ngIf="group.participants">
            <div class="users" fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="8px"
              cdkDropList
              [cdkDropListData]="group.participants"
              (cdkDropListDropped)="drop($event)">
              <div class="user" fxLayoutGap="8px" fxLayout="row"  
                cdkDrag
                *ngFor="let participant of group.participants">
                <span>
                  {{ participant.display_name }}
                </span>
                <img class="remove" (click)="removeUser()" src="/assets/img/idea-creation/close_big.svg">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="add-group" fxLayout="column" fxLayoutAlign="center center" (click)="addGroup()">
        + Add Group
      </div>
    </div>
  </div>
</div>



<!-- controls -->
<div class="end-buttons" fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="18px">
  <!-- <div fxLayout="column" class="white-button">Save changes</div> -->
  <div fxLayout="column" class="blue-button"
    (click)="makeActivityGrouping()"
    *ngIf="showStartGroupingButton">
    Start Grouping
  </div>
</div>