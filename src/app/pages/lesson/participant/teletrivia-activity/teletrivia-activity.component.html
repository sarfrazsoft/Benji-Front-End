<ng-container
  *ngIf="
    !activityState.teletriviaactivity.game_started &&
    !activityState.teletriviaactivity.circle_complete
  "
>
  <div class="b-flat-card center-text mc-card--circle">
    <div class="b-flat-card__title"><h2 class="pn-400">TELETRIVIA</h2></div>
    <div class="b-flat-card__body">
      <div class="b-flat-card__twemoji">
        <app-b-twemoji emoji="üí´"></app-b-twemoji>
      </div>
      <h3 class="pn-700 primary-color-darkest">Form a circle</h3>
      <p class="instruction">We‚Äôll get started once everyone is in position.</p>
    </div>
    <div class="b-flat-card__action">
      <button
        class="b-standard-button"
        (click)="sendReadyState()"
        [ngClass]="{ 'b-standard-button--inactive': participantInCircle() }"
      >
        <span *ngIf="!participantInCircle()"> I'm in the circle! </span>
        <span *ngIf="participantInCircle()"> Waiting... </span>
      </button>
    </div>
  </div>
</ng-container>

<ng-container
  *ngIf="
    !activityState.teletriviaactivity.game_started &&
    activityState.teletriviaactivity.circle_complete
  "
>
  <div class="b-flat-card center-text mc-card--circle">
    <div class="b-flat-card__title"><h2 class="pn-400">TELETRIVIA</h2></div>
    <div class="b-flat-card__body">
      <h3 class="pn-700 primary-color">Waiting...</h3>
      <div class="mc-card__loader"><mat-spinner></mat-spinner></div>
      <p>Get ready, the game is about to start.</p>
    </div>
  </div>
</ng-container>

<ng-container
  *ngIf="
    activityState.teletriviaactivity.game_started &&
    activityState.teletriviaactivity.circle_complete &&
    !activityState.teletriviaactivity.sharing_started
  "
>
  <div
    class="b-flat-card center-text mc-card "
    [ngClass]="{ 'mc-card--starter-layout': participantIsInitiator() }"
  >
    <div class="b-flat-card__title"><h2 class="pn-400">TELETRIVIA</h2></div>
    <div class="b-flat-card__body">
      <h3 class="pn-400 secondary-color-dark">
        {{
          activityState.teletriviaactivity.questions[currentQuestionIndex]
            .question
        }}
      </h3>
    </div>
    <div class="b-flat-card__action">
      <button
        class="b-standard-button b-standard-button--unselected"
        *ngFor="
          let choice of activityState.teletriviaactivity.questions[
            currentQuestionIndex
          ].mcqchoice_set;
          let i = index
        "
        [ngClass]="{
          'b-standard-button--correct': revealAnswer && choice.is_correct,
          'b-standard-button--incorrect':
            revealAnswer && !choice.is_correct && i === selectedAnswerIndex
        }"
        (click)="submitAnswer(choice)"
      >
        {{ choice.choice_text }}
      </button>
    </div>
    <div class="b-flat-card__action-detail" *ngIf="revealAnswer">
      <p>{{ answerExplanation }}</p>
    </div>
  </div>
  <div
    class="mc-card__timer mc-card__timer--starter-layout"
    [ngClass]="{ 'mc-card__timer--starter-layout': participantIsInitiator() }"
    *ngIf="!killTimer"
  >
    <benji-linear-timer
      *ngIf="!revealAnswer"
      (callback)="questionTimeUpCallback()"
      (initCallback)="startQuestionTimer($event)"
      #questionTimer
    ></benji-linear-timer>
    <benji-linear-timer
      *ngIf="revealAnswer"
      (callback)="submitAnswerCallback()"
      (initCallback)="startRevealTimer($event)"
      #revealTimer
    ></benji-linear-timer>
  </div>
  <div
    class="b-baseline-action bg-primary-color-dark"
    *ngIf="participantIsInitiator()"
  >
    <app-animated-checkmark-button
      loadingStateInnerHTML="Loading"
      innerHTML="Stop! The message is back"
      buttonStyle="white"
      [valid]="messageBack"
      (clicked)="openEndModal()"
    ></app-animated-checkmark-button>
  </div>
</ng-container>

<ng-container
  *ngIf="
    activityState.teletriviaactivity.game_started &&
    activityState.teletriviaactivity.circle_complete &&
    activityState.teletriviaactivity.sharing_started
  "
>
  <div class="b-flat-card center-text mc-card--circle">
    <div class="b-flat-card__title"><h2 class="pn-400">TELETRIVIA</h2></div>
    <div class="b-flat-card__body">
      <div class="b-flat-card__twemoji">
        <app-b-twemoji emoji="üëÇ"></app-b-twemoji>
      </div>
      <h3 class="pn-700 primary-color-darkest">Listen up</h3>
      <p>The message is back!</p>
    </div>
  </div>
</ng-container>

<!-- Dialogue Templates... see triggerDialogue method -->
<ng-template #kickofftemplate>
  <div class="b-dialog-template">
    <p>You‚Äôre starting telephone! Shh‚Ä¶ don‚Äôt show anyone the secret message.</p>
    <blockquote>
      ‚Äú{{ activityState.teletriviaactivity.secret_phrase }}‚Äù
    </blockquote>
    <p>
      Whisper it to your neighbour, and follow the prompts below to get the game
      rolling. Hit the ‚ÄòStop‚Äô button when the message gets back to you!
    </p>
    <div class="b-dialog-template__action">
      <button
        class="b-standard-button b-standard-button--white"
        *ngIf="!msessageShared"
        (click)="msessageShared = true"
      >
        I shared the message
      </button>
      <button
        class="b-standard-button b-standard-button--white"
        *ngIf="msessageShared"
        (click)="initiateTelephone()"
        [mat-dialog-close]="true"
      >
        Start the game!
      </button>
    </div>
  </div>
</ng-template>

<ng-template #endTemplate>
  <div class="b-dialog-template">
    <p>Share the message you just received with the rest of the group.</p>

    <p>Remember what the original message was?</p>

    <p>‚Äú{{ activityState.teletriviaactivity.secret_phrase }}‚Äù</p>
    <div class="b-dialog-template__action">
      <button
        class="b-standard-button b-standard-button--white"
        [mat-dialog-close]="true"
        (click)="endGame()"
      >
        Done
      </button>
    </div>
  </div>
</ng-template>
