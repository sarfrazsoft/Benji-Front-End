<form [formGroup]="form" (ngSubmit)="submitFeedback()">
  <div class="questionForm infeedback">
    <div class="b-flat-card__action feedback-card__questions" formArrayName="questions">
      <div class="feedback-card__question-box" *ngFor="let question of questions.controls; let i = index">
        <div [formGroupName]="i">

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'rating_agreedisagree'">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div class="feedback-rating">
              <div class="linked-radio-btns">
                <ol class="nodes">
                  <li class="node">
                    <input
                      class="linked-radio-btns__radio"
                      type="radio"
                      id="{{ 'r1' + question_set[i].id }}"
                      formControlName="rating_answer"
                      [value]="1"
                    />
                    <label class="linked-radio-btns__label" for="{{ 'r1' + question_set[i].id }}">
                      <span class="indicator">Strongly disagree</span>
                    </label>
                  </li>
                  <li class="node">
                    <input
                      class="linked-radio-btns__radio"
                      type="radio"
                      id="{{ 'r2' + question_set[i].id }}"
                      formControlName="rating_answer"
                      [value]="2"
                    />
                    <label class="linked-radio-btns__label" for="{{ 'r2' + question_set[i].id }}">
                      <span class="indicator"></span>
                    </label>
                  </li>
                  <li class="node">
                    <input
                      class="linked-radio-btns__radio"
                      type="radio"
                      id="{{ 'r3' + question_set[i].id }}"
                      formControlName="rating_answer"
                      [value]="3"
                    />
                    <label class="linked-radio-btns__label" for="{{ 'r3' + question_set[i].id }}">
                      <span class="indicator">Neutral</span>
                    </label>
                  </li>
                  <li class="node">
                    <input
                      class="linked-radio-btns__radio"
                      type="radio"
                      id="{{ 'r4' + question_set[i].id }}"
                      formControlName="rating_answer"
                      [value]="4"
                    />
                    <label class="linked-radio-btns__label" for="{{ 'r4' + question_set[i].id }}">
                      <span class="indicator"></span>
                    </label>
                  </li>
                  <li class="node">
                    <input
                      class="linked-radio-btns__radio"
                      type="radio"
                      id="{{ 'r5' + question_set[i].id }}"
                      formControlName="rating_answer"
                      [value]="5"
                    />
                    <label class="linked-radio-btns__label" for="{{ 'r5' + question_set[i].id }}">
                      <span class="indicator">Strongly agree</span>
                    </label>
                  </li>
                </ol>
              </div>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'text_only'" class="text-question">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div>
              <textarea
                id="text_answer"
                formControlName="text_answer"
                placeholder="Your comments!"
                class="b-standard-textarea"
              ></textarea>
            </div>
            <mat-error
              *ngIf="text_answer(i).invalid && (text_answer(i).dirty || text_answer(i).touched) && submitClicked"
              class="alert alert-danger">
              <div *ngIf="text_answer(i).errors.required">this is required.</div>
            </mat-error>
            <!-- <mat-error *ngIf="text_answer.invalid && (text_answer.dirty || text_answer.touched)" class="alert alert-danger">
              <div *ngIf="text_answer.errors.required">Email is required.</div>
              <div *ngIf="text_answer.errors.email">It should be a valid email.</div>
            </mat-error> -->
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'heart'">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div fxLayout="row" (mouseleave)="mouseoutIcon()">
              <button mat-icon-button type="button" class="question-icon favorite-icon" 
                *ngFor="let ratingId of heartsArr;index as j" 
                [id]="'favorite_'+j" 
                (click)="onClickHeart(i, j)"
                (mouseover)="mouseoverIcon(j)"
                [matTooltip]="ratingId" 
                matTooltipPosition="above"
                [matTooltipClass]="{ 'fav-tip': true }"
                [disableRipple]="true">
                <mat-icon class="mat-favorite">
                  {{ showFavouriteIcon(j) }}
                </mat-icon>
              </button>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'stars'">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div fxLayout="row" (mouseleave)="mouseoutStarIcon()">
              <button type="button" mat-icon-button class="question-icon star-icon" 
                *ngFor="let ratingId of starsArr;index as j" 
                [id]="'star_'+j" 
                (click)="onClickStar(i, j)"
                (mouseover)="mouseoverStarIcon(j)"
                [matTooltip]="ratingId"
                matTooltipPosition="above"
                [matTooltipClass]="{ 'star-tip': true }"
                [disableRipple]="true">
                <mat-icon class="mat-star">
                  {{ showStarIcon(j) }}
                </mat-icon>
              </button>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'emoji'">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div fxLayout="row" fxLayoutAlign="start center">
              <button type="button" mat-icon-button class="question-icon thumb" (click)="onSentimentClick(i, 1)" [disableRipple]="true">
                <mat-icon class="mat-emoticon" [ngClass]="{'selected': emojiRating === 1}">
                  sentiment_very_dissatisfied
                </mat-icon>
              </button>
              <button type="button" mat-icon-button class="question-icon thumb" (click)="onSentimentClick(i, 2)" [disableRipple]="true">
                <mat-icon class="mat-emoticon" [ngClass]="{'selected': emojiRating === 2}">
                  sentiment_dissatisfied
                </mat-icon>
              </button>
              <button type="button" mat-icon-button class="question-icon thumb" (click)="onSentimentClick(i, 3)" [disableRipple]="true">
                <mat-icon class="mat-emoticon" [ngClass]="{'selected': emojiRating === 3}">
                  sentiment_neutral
                </mat-icon>
              </button>
              <button type="button" mat-icon-button class="question-icon thumb" (click)="onSentimentClick(i, 4)" [disableRipple]="true">
                <mat-icon class="mat-emoticon" [ngClass]="{'selected': emojiRating === 4}">
                  sentiment_satisfied
                </mat-icon>
              </button>
              <button type="button" mat-icon-button class="question-icon thumb selected" (click)="onSentimentClick(i, 5)" [disableRipple]="true">
                <mat-icon class="mat-emoticon" [ngClass]="{'selected': emojiRating === 5}">
                  sentiment_very_satisfied
                </mat-icon>
              </button>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'thumb_up'">
            <div class="title">{{ question_set[i].question_text }}</div>
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
              <button type="button" [disableRipple]="true"
                mat-icon-button 
                class="question-icon thumb"
                (click)="onThumbClick(i, 2)">
                <mat-icon class="mat-thumb" [ngClass]="{'selected': thumbRating === 2}">
                  thumb_up
                </mat-icon>
              </button>
              <button [disableRipple]="true"
                type="button" 
                mat-icon-button 
                class="question-icon thumb"
                (click)="onThumbClick(i, 1)">
                <mat-icon class="mat-thumb" [ngClass]="{'selected': thumbRating === 1}">
                  thumb_down
                </mat-icon>
              </button>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'scale'" class="rating-slider">
            <div class="title">{{ question_set[i].question_text }}</div>
            <mat-slider 
              [min]="getScaleMin(question_set[i])" 
              [max]="getScaleMax(question_set[i])" 
              thumbLabel 
              aria-label="unit(s)"
              (change)="scaleChanged($event, i)">
            </mat-slider>
            <div class="labels" 
              fxLayout="row" 
              fxLayoutAlign="space-between center">
              <span *ngFor="let label of getScaleLabels(question_set[i])">{{ label }}</span>
            </div>
          </div>

          <div fxLayout="column" *ngIf="question_set[i].question_type === 'multiple_choice'" class="multiple-choice">
            <benji-ps-feedback-mcq
              [question]="question_set[i]"
              (selectChoice)="mcqChoiceSelect(i, $event)"
              [actEditor]="actEditor">
            </benji-ps-feedback-mcq>
          </div>
        </div>
      </div>
    </div>

    <button class="b-standard-button bg-primary-color" [ngClass]="{ inactive: !form.valid }" type="submit">
      Submit
    </button>
  </div>
</form>
